class Api::V1::GeonamesController < ApiController

  def search
    return permission_denied_error unless current_user
    return error(message: "Insufficient search params", line: __LINE__) unless params[:query].try(:length)

    query = params[:query].to_s

    # res = HTTParty.get "http://api.geonames.org/search?q=#{ query }&fuzzy=0.8&username=#{ username }&lang=en&type=json&maxRows=10&style=full"
    res = HTTParty.get "http://api.geonames.org/search?q=#{ query }&featureClass=P&username=#{ username }&lang=en&type=json&maxRows=25&style=full"
    render json: res.body
  end

  def find
    return permission_denied_error unless current_user
    return error(message: "Insufficient search params", line: __LINE__) unless params[:id].try(:length)

    id = params[:id].to_s

    res = HTTParty.get "http://api.geonames.org/getJSON?geonameId=#{ id }&username=#{ username }&lang=en&type=json&style=full"
    render json: res.body
  end

  def country_admins
    return permission_denied_error unless current_user
    return error(message: "Insufficient search params", line: __LINE__) unless params[:country_id].try(:length)

    id = params[:country_id].to_s

    res = HTTParty.get "http://api.geonames.org/searchJSON?country=#{ countryCodeForId( id ) }&featureCode=ADM1&username=#{ username }&lang=en&type=json&style=full"
    render json: res.body
  end

  def point
    return permission_denied_error unless current_user
    return error(message: "Insufficient search params", line: __LINE__) unless params[:lat].try(:length) && params[:lon].try(:length)

    lat = params[:lat].to_i
    lon = params[:lon].to_i

    # http://api.geonames.org/findNearbyPlaceNameJSON?lat=35.7111057142935&lng=139.796369075775&username=planit
    res = HTTParty.get "http://api.geonames.org/findNearbyPlaceNameJSON?lat=#{ lat }&lng=#{ lon }&radius=10&username=#{ username }&lang=en&maxRows=10&style=full"
    render json: res.body
  end

  private

  def username
    "planit"
  end

  def countryCodeForId( code )
    case code.to_i
      when 3041565 then 'AD'
      when 290557 then 'AE'
      when 1149361 then 'AF'
      when 3576396 then 'AG'
      when 3573511 then 'AI'
      when 783754 then 'AL'
      when 174982 then 'AM'
      when 3351879 then 'AO'
      when 6697173 then 'AQ'
      when 3865483 then 'AR'
      when 5880801 then 'AS'
      when 2782113 then 'AT'
      when 2077456 then 'AU'
      when 3577279 then 'AW'
      when 661882 then 'AX'
      when 587116 then 'AZ'
      when 3277605 then 'BA'
      when 3374084 then 'BB'
      when 1210997 then 'BD'
      when 2802361 then 'BE'
      when 2361809 then 'BF'
      when 732800 then 'BG'
      when 290291 then 'BH'
      when 433561 then 'BI'
      when 2395170 then 'BJ'
      when 3578476 then 'BL'
      when 3573345 then 'BM'
      when 1820814 then 'BN'
      when 3923057 then 'BO'
      when 7626844 then 'BQ'
      when 3469034 then 'BR'
      when 3572887 then 'BS'
      when 1252634 then 'BT'
      when 3371123 then 'BV'
      when 933860 then 'BW'
      when 630336 then 'BY'
      when 3582678 then 'BZ'
      when 6251999 then 'CA'
      when 1547376 then 'CC'
      when 203312 then 'CD'
      when 239880 then 'CF'
      when 2260494 then 'CG'
      when 2658434 then 'CH'
      when 2287781 then 'CI'
      when 1899402 then 'CK'
      when 3895114 then 'CL'
      when 2233387 then 'CM'
      when 1814991 then 'CN'
      when 3686110 then 'CO'
      when 3624060 then 'CR'
      when 3562981 then 'CU'
      when 3374766 then 'CV'
      when 7626836 then 'CW'
      when 2078138 then 'CX'
      when 146669 then 'CY'
      when 3077311 then 'CZ'
      when 2921044 then 'DE'
      when 223816 then 'DJ'
      when 2623032 then 'DK'
      when 3575830 then 'DM'
      when 3508796 then 'DO'
      when 2589581 then 'DZ'
      when 3658394 then 'EC'
      when 453733 then 'EE'
      when 357994 then 'EG'
      when 2461445 then 'EH'
      when 338010 then 'ER'
      when 2510769 then 'ES'
      when 337996 then 'ET'
      when 660013 then 'FI'
      when 2205218 then 'FJ'
      when 3474414 then 'FK'
      when 2081918 then 'FM'
      when 2622320 then 'FO'
      when 3017382 then 'FR'
      when 2400553 then 'GA'
      when 2635167 then 'GB'
      when 3580239 then 'GD'
      when 614540 then 'GE'
      when 3381670 then 'GF'
      when 3042362 then 'GG'
      when 2300660 then 'GH'
      when 2411586 then 'GI'
      when 3425505 then 'GL'
      when 2413451 then 'GM'
      when 2420477 then 'GN'
      when 3579143 then 'GP'
      when 2309096 then 'GQ'
      when 390903 then 'GR'
      when 3474415 then 'GS'
      when 3595528 then 'GT'
      when 4043988 then 'GU'
      when 2372248 then 'GW'
      when 3378535 then 'GY'
      when 1819730 then 'HK'
      when 1547314 then 'HM'
      when 3608932 then 'HN'
      when 3202326 then 'HR'
      when 3723988 then 'HT'
      when 719819 then 'HU'
      when 1643084 then 'ID'
      when 2963597 then 'IE'
      when 294640 then 'IL'
      when 3042225 then 'IM'
      when 1269750 then 'IN'
      when 1282588 then 'IO'
      when 99237 then 'IQ'
      when 130758 then 'IR'
      when 2629691 then 'IS'
      when 3175395 then 'IT'
      when 3042142 then 'JE'
      when 3489940 then 'JM'
      when 248816 then 'JO'
      when 1861060 then 'JP'
      when 192950 then 'KE'
      when 1527747 then 'KG'
      when 1831722 then 'KH'
      when 4030945 then 'KI'
      when 921929 then 'KM'
      when 3575174 then 'KN'
      when 1873107 then 'KP'
      when 1835841 then 'KR'
      when 831053 then 'XK'
      when 285570 then 'KW'
      when 3580718 then 'KY'
      when 1522867 then 'KZ'
      when 1655842 then 'LA'
      when 272103 then 'LB'
      when 3576468 then 'LC'
      when 3042058 then 'LI'
      when 1227603 then 'LK'
      when 2275384 then 'LR'
      when 932692 then 'LS'
      when 597427 then 'LT'
      when 2960313 then 'LU'
      when 458258 then 'LV'
      when 2215636 then 'LY'
      when 2542007 then 'MA'
      when 2993457 then 'MC'
      when 617790 then 'MD'
      when 3194884 then 'ME'
      when 3578421 then 'MF'
      when 1062947 then 'MG'
      when 2080185 then 'MH'
      when 718075 then 'MK'
      when 2453866 then 'ML'
      when 1327865 then 'MM'
      when 2029969 then 'MN'
      when 1821275 then 'MO'
      when 4041468 then 'MP'
      when 3570311 then 'MQ'
      when 2378080 then 'MR'
      when 3578097 then 'MS'
      when 2562770 then 'MT'
      when 934292 then 'MU'
      when 1282028 then 'MV'
      when 927384 then 'MW'
      when 3996063 then 'MX'
      when 1733045 then 'MY'
      when 1036973 then 'MZ'
      when 3355338 then 'NA'
      when 2139685 then 'NC'
      when 2440476 then 'NE'
      when 2155115 then 'NF'
      when 2328926 then 'NG'
      when 3617476 then 'NI'
      when 2750405 then 'NL'
      when 3144096 then 'NO'
      when 1282988 then 'NP'
      when 2110425 then 'NR'
      when 4036232 then 'NU'
      when 2186224 then 'NZ'
      when 286963 then 'OM'
      when 3703430 then 'PA'
      when 3932488 then 'PE'
      when 4030656 then 'PF'
      when 2088628 then 'PG'
      when 1694008 then 'PH'
      when 1168579 then 'PK'
      when 798544 then 'PL'
      when 3424932 then 'PM'
      when 4030699 then 'PN'
      when 4566966 then 'PR'
      when 6254930 then 'PS'
      when 2264397 then 'PT'
      when 1559582 then 'PW'
      when 3437598 then 'PY'
      when 289688 then 'QA'
      when 935317 then 'RE'
      when 798549 then 'RO'
      when 6290252 then 'RS'
      when 2017370 then 'RU'
      when 49518 then 'RW'
      when 102358 then 'SA'
      when 2103350 then 'SB'
      when 241170 then 'SC'
      when 366755 then 'SD'
      when 7909807 then 'SS'
      when 2661886 then 'SE'
      when 1880251 then 'SG'
      when 3370751 then 'SH'
      when 3190538 then 'SI'
      when 607072 then 'SJ'
      when 3057568 then 'SK'
      when 2403846 then 'SL'
      when 3168068 then 'SM'
      when 2245662 then 'SN'
      when 51537 then 'SO'
      when 3382998 then 'SR'
      when 2410758 then 'ST'
      when 3585968 then 'SV'
      when 7609695 then 'SX'
      when 163843 then 'SY'
      when 934841 then 'SZ'
      when 3576916 then 'TC'
      when 2434508 then 'TD'
      when 1546748 then 'TF'
      when 2363686 then 'TG'
      when 1605651 then 'TH'
      when 1220409 then 'TJ'
      when 4031074 then 'TK'
      when 1966436 then 'TL'
      when 1218197 then 'TM'
      when 2464461 then 'TN'
      when 4032283 then 'TO'
      when 298795 then 'TR'
      when 3573591 then 'TT'
      when 2110297 then 'TV'
      when 1668284 then 'TW'
      when 149590 then 'TZ'
      when 690791 then 'UA'
      when 226074 then 'UG'
      when 5854968 then 'UM'
      when 6252001 then 'US'
      when 3439705 then 'UY'
      when 1512440 then 'UZ'
      when 3164670 then 'VA'
      when 3577815 then 'VC'
      when 3625428 then 'VE'
      when 3577718 then 'VG'
      when 4796775 then 'VI'
      when 1562822 then 'VN'
      when 2134431 then 'VU'
      when 4034749 then 'WF'
      when 4034894 then 'WS'
      when 69543 then 'YE'
      when 1024031 then 'YT'
      when 953987 then 'ZA'
      when 895949 then 'ZM'
      when 878675 then 'ZW'
    end
  end

end